{{template "head"}}
<body>
{{template "navBar" .}}
    <main>
        <!-- Button to toggle filter visibility -->
        <button onclick="toggleFilter()" class="show-filter-button">Show Filters</button>

        <!-- Filter Form (hidden by default) -->
        <form class="filter" method="POST" action="/">
            <div class="filter-group">
                <!-- Topic Filter -->
                <label for="topicFilter" class="filter-label">Filter by Category:</label>
                <select id="topicFilter" name="topic" class="filter-select">
                    <option value="None">-</option>
                    {{ range $index, $category := .Categories }}
                    <option value="{{ $category.CategoryID }}">{{ $category.CategoryName }}</option>
                    {{ end }}
                </select>
                
                <!-- Only show "Created by Me" if the user is logged in -->
                {{if .LoggedIn}}
                    <span class="or">or</span>
                    <label for="postFilter" class="filter-label">Filter by Action:</label>
                    <select id="postFilter" name="filter" class="filter-select">
                        <option value="None">-</option>
                        <option value="createdByMe">Created by Me</option>
                        <option value="likedByMe">Liked by Me</option>
                        <option value="dislikedByMe">Disliked by Me</option>
                    </select>
                {{end}}
            </div>
            <button type="submit" class="filter-button">Apply Filters</button>
        </form>

        <!-- Latest Posts Header with Create Post link -->
        <div class="latest-posts-header">
            <h2>Latest Posts</h2>
            <a class="create-post" href="/create-post">Create Post</a>
        </div>

        {{range .Posts}}
        <div class="post">
            <h3><a href="/post/{{.PostID}}">{{.PostTitle}}</a></h3> 
            <p>Author: {{.Username}}</p>
            <p class="post-content">{{.PostContent}}</p>
            <p><strong>Comments:</strong> {{len .Comments}}</p>
        </div>
        {{else}}
        <p>No posts yet. Be the first to create one!</p>
        {{end}}
    </main>
{{template "footer"}}
</body>
<script>
    function toggleFilter() {
        var filter = document.querySelector('.filter');
        var button = document.querySelector('.show-filter-button');

        if (filter.classList.contains('show')) {
            filter.style.opacity = '0';
            setTimeout(() => {
                filter.classList.remove('show');
                filter.style.display = 'none';
            }, 300); // Matches transition
            button.textContent = 'Show Filters';
        } else {
            filter.style.display = 'flex';  // Change to 'flex' to maintain layout
            setTimeout(() => {
                filter.classList.add('show');
                filter.style.opacity = '1';
            }, 10); // Ensures transition works
            button.textContent = 'Hide Filters';
        }
    }
</script>
</html>
